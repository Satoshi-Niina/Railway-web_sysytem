# ===================================# å¾¹åº•çš„ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢ï¼†ãƒ‡ãƒ—ãƒ­ã‚¤ã‚¹ã‚¯ãƒªãƒ—ãƒˆ# ===================================Write-Host "===========================================================" -ForegroundColor CyanWrite-Host "ğŸš€ å¾¹åº•çš„ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢ãƒ‡ãƒ—ãƒ­ã‚¤é–‹å§‹" -ForegroundColor CyanWrite-Host "===========================================================" -ForegroundColor Cyan# ===================================# 1. GitçŠ¶æ…‹ç¢ºèª# ===================================Write-Host "`nğŸ“‹ Step 1: GitçŠ¶æ…‹ç¢ºèª" -ForegroundColor Yellow$gitStatus = git status --porcelainif ($gitStatus) {    Write-Host "âš ï¸  æœªã‚³ãƒŸãƒƒãƒˆã®å¤‰æ›´ãŒã‚ã‚Šã¾ã™:" -ForegroundColor Red    Write-Host $gitStatus    $response = Read-Host "ç¶šè¡Œã—ã¾ã™ã‹ï¼Ÿ (y/N)"    if ($response -ne "y") {        Write-Host "âŒ ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’ä¸­æ­¢ã—ã¾ã—ãŸ" -ForegroundColor Red        exit 1    }}# ===================================# 2. Next.jså®Œå…¨ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—# ===================================Write-Host "`nğŸ§¹ Step 2: Next.jså®Œå…¨ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—" -ForegroundColor Yellowif (Test-Path "client\.next") {    Write-Host "  å‰Šé™¤: client\.next" -ForegroundColor Gray    Remove-Item -Path "client\.next" -Recurse -Force -ErrorAction SilentlyContinue}if (Test-Path ".turbo") {    Write-Host "  å‰Šé™¤: .turbo" -ForegroundColor Gray    Remove-Item -Path ".turbo" -Recurse -Force -ErrorAction SilentlyContinue}if (Test-Path "client\node_modules\.cache") {    Write-Host "  å‰Šé™¤: client\node_modules\.cache" -ForegroundColor Gray    Remove-Item -Path "client\node_modules\.cache" -Recurse -Force -ErrorAction SilentlyContinue}# ===================================# 3. pnpmã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢# ===================================Write-Host "`nğŸ—‘ï¸  Step 3: pnpmã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢" -ForegroundColor Yellowpnpm store pruneWrite-Host "  âœ… pnpm store pruned" -ForegroundColor Green# ===================================# 4. Dockerã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢# ===================================Write-Host "`nğŸ³ Step 4: Dockerã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢" -ForegroundColor Yellow$dockerCheck = docker --version 2>&1if ($LASTEXITCODE -eq 0) {    Write-Host "  Dockerãƒ“ãƒ«ãƒ‰ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ã‚¯ãƒªã‚¢ä¸­..." -ForegroundColor Gray    docker builder prune -af --filter "label!=keep" 2>&1 | Out-Null    Write-Host "  âœ… Dockerã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢å®Œäº†" -ForegroundColor Green} else {    Write-Host "  â­ï¸  Dockeræœªä½¿ç”¨ã®ãŸã‚ã‚¹ã‚­ãƒƒãƒ—" -ForegroundColor Gray}# ===================================# 5. ãƒ­ãƒ¼ã‚«ãƒ«ãƒ“ãƒ«ãƒ‰ã‚­ãƒ£ãƒƒã‚·ãƒ¥å‰Šé™¤# ===================================Write-Host "`nğŸ”„ Step 5: ãƒ­ãƒ¼ã‚«ãƒ«ãƒ“ãƒ«ãƒ‰ã‚­ãƒ£ãƒƒã‚·ãƒ¥å‰Šé™¤" -ForegroundColor Yellow$cacheDirs = @(    "client\.next\cache",    "server\dist",    "client\out",    ".eslintcache")foreach ($dir in $cacheDirs) {    if (Test-Path $dir) {        Write-Host "  å‰Šé™¤: $dir" -ForegroundColor Gray        Remove-Item -Path $dir -Recurse -Force -ErrorAction SilentlyContinue    }}# ===================================# 6. å¼·åˆ¶ãƒ“ãƒ«ãƒ‰ï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ãªã—ï¼‰# ===================================Write-Host "`nğŸ”¨ Step 6: ã‚¯ãƒªãƒ¼ãƒ³ãƒ“ãƒ«ãƒ‰å®Ÿè¡Œ" -ForegroundColor YellowWrite-Host "  client ãƒ“ãƒ«ãƒ‰é–‹å§‹..." -ForegroundColor GrayPush-Location client$env:NEXT_TELEMETRY_DISABLED = "1"pnpm build --no-cache 2>&1$buildExitCode = $LASTEXITCODEPop-Locationif ($buildExitCode -ne 0) {    Write-Host "`nâŒ ãƒ“ãƒ«ãƒ‰ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ" -ForegroundColor Red    exit 1}Write-Host "  âœ… ãƒ“ãƒ«ãƒ‰æˆåŠŸ" -ForegroundColor Green# ===================================# 7. Gitã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢# ===================================Write-Host "`nğŸ”„ Step 7: Gitã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢" -ForegroundColor Yellowgit rm -r --cached . 2>&1 | Out-Nullgit add . 2>&1 | Out-NullWrite-Host "  âœ… Gitã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢å®Œäº†" -ForegroundColor Green# ===================================# 8. ã‚³ãƒŸãƒƒãƒˆï¼†ãƒ—ãƒƒã‚·ãƒ¥ï¼ˆå¼·åˆ¶ï¼‰# ===================================Write-Host "`nğŸ“¤ Step 8: ã‚³ãƒŸãƒƒãƒˆï¼†ãƒ—ãƒƒã‚·ãƒ¥" -ForegroundColor Yellow$timestamp = Get-Date -Format "yyyy-MM-dd HH:mm:ss"$commitMsg = "deploy: å®Œå…¨ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢å¾Œãƒ‡ãƒ—ãƒ­ã‚¤ ($timestamp)"git add -Agit commit -m $commitMsg --allow-empty$commitExitCode = $LASTEXITCODEif ($commitExitCode -eq 0 -or $commitExitCode -eq 1) {    Write-Host "  âœ… ã‚³ãƒŸãƒƒãƒˆå®Œäº†" -ForegroundColor Green        Write-Host "  Pushing to origin/main..." -ForegroundColor Gray    git push origin main --force-with-lease        if ($LASTEXITCODE -eq 0) {        Write-Host "  âœ… ãƒ—ãƒƒã‚·ãƒ¥å®Œäº†" -ForegroundColor Green    } else {        Write-Host "`nâŒ ãƒ—ãƒƒã‚·ãƒ¥ã‚¨ãƒ©ãƒ¼" -ForegroundColor Red        exit 1    }} else {    Write-Host "`nâŒ ã‚³ãƒŸãƒƒãƒˆã‚¨ãƒ©ãƒ¼" -ForegroundColor Red    exit 1}# ===================================# 9. ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ç¢ºèª# ===================================Write-Host "`nğŸ”” Step 9: ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ç¢ºèª" -ForegroundColor YellowWrite-Host "  RailwayãŒgit pushã‚’æ¤œçŸ¥ã—ã¦è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’é–‹å§‹ã—ã¾ã™" -ForegroundColor GrayWrite-Host "  âš ï¸  Railwayå´ã§ã‚‚ä»¥ä¸‹ã‚’ç¢ºèªã—ã¦ãã ã•ã„:" -ForegroundColor YellowWrite-Host "    - Railwayãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ > Settings > Clear Build Cache" -ForegroundColor GrayWrite-Host "    - Redeploy ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯" -ForegroundColor Gray# ===================================# å®Œäº†# ===================================Write-Host ""Write-Host "===========================================================" -ForegroundColor CyanWrite-Host "âœ… å¾¹åº•çš„ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢ãƒ‡ãƒ—ãƒ­ã‚¤å®Œäº†ï¼" -ForegroundColor GreenWrite-Host ""Write-Host "æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—:" -ForegroundColor CyanWrite-Host "  1. Railwayãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ­ã‚°ã‚’ç¢ºèª" -ForegroundColor WhiteWrite-Host "  2. ãƒ–ãƒ©ã‚¦ã‚¶ã§ Ctrl+Shift+Rï¼ˆå¼·åˆ¶ãƒªãƒ­ãƒ¼ãƒ‰ï¼‰" -ForegroundColor WhiteWrite-Host "  3. ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã¨Cookieã‚’ã‚¯ãƒªã‚¢" -ForegroundColor WhiteWrite-Host "===========================================================" -ForegroundColor CyanWrite-Host ""